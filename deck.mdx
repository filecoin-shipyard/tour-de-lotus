import { Head } from 'mdx-deck'
import { TourContext } from './theme'
export { default as theme } from './theme'
import { LiveCode } from 'mdx-deck-live-code'
// import LotusRPC from '@filecoin-shipyard/lotus-client-rpc';
// import LotusRPC from './lotus-client-rpc';
// import BrowserProvider from '@filecoin-shipyard/lotus-client-provider-browser';
// import BrowserProvider from './lotus-client-provider-browser';
// import schema from '@filecoin-shipyard/lotus-client-schema/prototype/testnet-v3.js';
import { useState, useEffect, useRef, useCallback } from 'react'
import ReactJson from 'react-json-view'
import { useImmer } from 'use-immer'
import clientNode from './client-node'
import clientMiner from './client-miner'
import useMiners from './use-miners'
import useActorAddress from './use-actor-address'
import transformCode from './transform'
import baseImports from './base-imports'

<Head>
  <title>Tour de Lotus</title>
</Head>

<div style={{display: 'flex', margin: '5rem', height: '90vh', alignItems: 'center'}}>
  <div style={{width: '50%'}}>
    <h1 style={{fontSize: '60pt'}}>Tour de Lotus</h1>
  </div>
  <div style={{width: '50%', height: '100%'}}>
    <img style={{height: '100%'}} src='./images/tour-de-lotus.jpg' />
  </div>
</div>

---

Select a network:

<div>
  <input type='radio' name='net' value='localnet' defaultChecked={true} />
  Localnet
</div>
<div>
  <input type='radio' name='net' value='simulated' />
  Simulated
</div>

---

<div>
  <img style={{height: '100%'}} src='./images/three-miners.jpg' />
</div>

---

## Let's connect to our Node

---

<LiveCode
  title='ChainHead Height'
  size='fullscreen'
  code={require('!raw-loader!./chain-head-height.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 4,
      TourContext,
      client: clientNode,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

## Miners

On this network, each Node also has an associated Miner.

Which one is ours?

---

<LiveCode
  title='Miner Actor Address'
  size='fullscreen'
  code={require('!raw-loader!./miner/actor-address.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 6,
      TourContext,
      client: clientMiner,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>


---

<LiveCode
  title='ChainNotify Blocks'
  size='fullscreen'
  code={require('!raw-loader!./chain-notify-blocks.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 7,
      TourContext,
      client: clientNode,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

# State

---

<LiveCode
  title='State Power All'
  size='fullscreen'
  code={require('!raw-loader!./state/power-all.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 9,
      TourContext,
      client: clientNode,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

<LiveCode
  title='State List Miners'
  size='fullscreen'
  code={require('!raw-loader!./state/list-miners.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 10,
      TourContext,
      client: clientNode,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

<LiveCode
  title='State List Miners + Power'
  size='fullscreen'
  code={require('!raw-loader!./state/power-miners.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 11,
      TourContext,
      client: clientNode,
      ...baseImports,
      useMiners
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

Let's Make a Deal!

---

<LiveCode
  title='Capture Media'
  size='fullscreen'
  code={require('!raw-loader!./deal/capture-media.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 13,
      TourContext,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

<LiveCode
  title='Import'
  size='fullscreen'
  code={require('!raw-loader!./deal/import.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 14,
      TourContext,
      client: clientNode,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

<LiveCode
  title='List Miners for Deals'
  size='fullscreen'
  code={require('!raw-loader!./deal/miners.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 15,
      TourContext,
      clientNode,
      clientMiner,
      ...baseImports,
      useMiners,
      useActorAddress
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---

<LiveCode
  title='Default Wallet and Balance'
  size='fullscreen'
  code={require('!raw-loader!./deal/default-wallet-and-balance.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      slideIndex: 16,
      TourContext,
      client: clientNode,
      ...baseImports
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>


---
## Blocks

---

## State: Power

* StateNetworkName
* StateMinerPower
* StatePledgeCollateral

---

## State: Actors

* StateListActors
* StateGetActor
* StateReadState
* StateLookupID
* StateMarketBalance

---

# State: Miners

* StateListMiners
* StateMinerProvingSet
* StateMinerWorker
* StateMinerPeerID
* StateMinerPostState
* StateMinerSectorCount
* StateMinerFaults
* StateSectorPreCommitInfo
* StateListRewards

---

# State: Markets

* StateMarketDeals
* StateMarketStorageDeal

---

## State: Messages

* StateListMessages
* StateSearchMsg
* StateWaitMsg
* StateGetReceipt

---

# State: Other

* StateCall
* StateReplay
* StateCompute

---

## Syncing the Chain

---

## ChainHead JSON

---

## Tipsets

---

### State

---

## Addresses

---

## Messages

---

## Signing

---

## Message Pool

---

## Nodes

---

## Networking

---

## Miners

---

## Power

---

## Block Rewards

---

## Sectors

---

## Proofs

---

## Markets

---

## Asks

---

## Making Deals

---

## Deal Status

---

## Payment Channels

---

## Proving

---

## Actors

---

<LiveCode
  title='ChainHead Result'
  size='fullscreen'
  code={require('!raw-loader!./chain-head-result.js')}
  providerProps={{
    transformCode,
    noInline: true,
    scope: {
      TourContext,
      client: clientNode,
      ...baseImports,
      ReactJson
    }
  }}
  editorProps={{ style: { fontSize: '0.4em', background: '#001628' } }}
/>

---
